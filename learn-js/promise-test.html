<script>
  let p = new Promise((resolve,reject) => {
    let xhr = new XMLHttpRequest()
    xhr.open('GET', 'a.txt')
    xhr.onload = (e) => {
      if(xhr.status < 400){
        resolve(xhr.responseText)
      }else{
        reject({
          errno: xhr.status,
          respose:xhr.responseText
        })
      }
    }
  })

  // p.then(function onReceived() {

  // },function onRejected(){

  // })

  p.then( value =>{

  }, reason =>{

  })


  //可以给同一个Promise实例挂不同的函数
  p.then( value =>{

  }, reason =>{

  })




  class Promise {
    constructor(executor){
      function res() {

      }
      function rej() {

      }

    }
  }


  function getJSON(url) {
    let xhr = new XMLHttpRequest()
    xhr.open('GET',url)
    xhr.onload = (e) => {
      if(e.status < 400){
        return new Promise((resoleve) => {
          resoleve(JSON.parse(xhr.responseText))
        })
      }else{
        return new Promise((resoleve,reject) => {
          reject({
            status:xhr.status,
            message:"can't get data"
          })
        })
      }
    }
  }

  function getJSON(url) {
    return new Promise((resolve,reject) => {

    })
  }

  getJSON('a.json').then(data => {

  }, reason => {

  })


  Promise.resolve =  function(value) {
    return new Promise((resolve) => {
      resolve(value)
    })
  }

  Promise.reject =  function(value) {
    return new Promise((_,reject) => {
      reject(value)
    })
  }


  function getValue(value) {
    return new Promise(resolve => {
      setTimeout(()=>{
        resolve(value)
      },3000 + Math.random * 2000)
    })
  }

  function sleep(time) {
    return new Promise(resolve => {
      setTimeout(()=>resolve(),time)
    })
  }

  sleep(5000).then(() => {
    console.log(1)
  })

  function all(promises) {
    return new Promise((resolve,reject) => {
      for(let promise of promises){
        if(Promise.resolve(promise)){

        }
      }
    })
  }


  function  race(promises){
    return new Promise((resolve,reject) => {
      for(let i = 0; i < promises.length; i++){
        let promise = promise[i]
        promise.then(value => {
          resolve(value)
        },reason => {
          reject(value)
        })
      }
    })
  }
  Promise.allSettled = function (promises) {
    return new Promise(resolve => {
      let res = []
      let count = 0
      if(promises.length){
        for(let i = 0; i < promises.length; i++){
          let promise = promises[i]
          promise.then(value => {
            count++
            res[i] = {
              status:'fulfilled',
              value:value
            }
            if(count == promises.length){
              resolve(res)
            }
          }, reason => {
            count++
            res[i] = {
              status:'rejected',
              value:value
            }
            if(count == promises.length){
              resolve(res)
            }
          })
        }
      }else{
        resolve(res)
      }

      })
  }


  img1.ready = function () {
    return new Promise((resolve,reject) => {
      this.onload = () => {
        resolve()
      }
      this.onerror = () => {
        reject()
      }
    })
  }


  function deferred() {
    let dfd = {}
    dfd.promise = new Promise((resolve,reject) => {
      dfd.resolve = resolve
      dfd.reject = reject
    })
    return dfd
  }
</script>


